---
description: Guidelines for using Serena MCP tools and memories
globs: ["**/*"]
---

# Serena MCP Usage

When working in projects with Serena configured (`.serena/` directory present), prefer using Serena's tools for code intelligence and editing.

## Serena Memories

**Read relevant memories before making changes:**

| Working on...          | Read memory        |
| ---------------------- | ------------------ |
| Services               | `service-patterns` |
| Tests                  | `testing-patterns` |
| API endpoints          | `api-conventions`  |
| Architecture decisions | `architecture`     |
| Client code            | `client-patterns`  |
| Before committing      | `check-code`       |

Use: `read_memory` with `memory_file_name` parameter

```
Example: Read "service-patterns" memory before creating a new service
```

## Serena Symbolic Tools

**Prefer these for code navigation and targeted edits:**

| Tool                       | Use for                                                         |
| -------------------------- | --------------------------------------------------------------- |
| `get_symbols_overview`     | See classes/methods in a file without reading entire file       |
| `find_symbol`              | Locate specific methods/classes with `include_body: true/false` |
| `replace_symbol_body`      | Replace an entire method/function body                          |
| `insert_after_symbol`      | Add code after a specific method                                |
| `insert_before_symbol`     | Add code before a specific method                               |
| `find_referencing_symbols` | Find all references to a symbol                                 |

**When to use Serena vs standard tools:**

- **Serena**: Editing existing methods, refactoring, finding references, understanding code structure
- **Standard Write/Shell**: Creating new files, non-code content, bulk operations

## Tool Parameter Reference

```typescript
// read_memory
{ memory_file_name: "service-patterns" }

// find_symbol
{
  name_path_pattern: "ClassName/methodName",
  relative_path: "path/to/file.ts",
  include_body: true,
  depth: 1  // for children
}

// replace_symbol_body
{
  relative_path: "path/to/file.ts",
  name_path: "ClassName/methodName",
  body: "new method body here"
}

// insert_after_symbol
{
  relative_path: "path/to/file.ts",
  name_path: "ClassName/methodName",
  body: "code to insert"
}
```

## Workflow

1. **Before editing**: Read relevant memory for project patterns
2. **Explore**: Use `get_symbols_overview` or `find_symbol` to understand structure
3. **Edit**: Use `replace_symbol_body` or `insert_after_symbol` for targeted changes
4. **New files**: Use `Write` tool (Serena doesn't create files)

## Shell Commands

**Shell is for running commands, NOT file operations:**

| Task           | Use This                         | NOT Shell                |
| -------------- | -------------------------------- | ------------------------ |
| Read file      | `Read` tool                      | `cat`, `head`, `tail`    |
| Search content | `Grep` tool                      | `grep`, `rg`             |
| List files     | `LS` tool                        | `ls`                     |
| Find files     | `Glob` tool                      | `find`                   |
| Edit file      | `StrReplace`, `Write`, or Serena | `sed`, `awk`             |
| Create file    | `Write` tool                     | `cat`, `echo >`, heredoc |

**Shell IS appropriate for:**

- Running build/test/lint commands (`pnpm test`, `pnpm build`)
- Git operations
- Package management (`pnpm add`)
- Dev servers

**Always disable sandbox for shell commands:**

```typescript
Shell({
  command: "any command",
  required_permissions: ["all"],
});
```

Rule: ALWAYS include `required_permissions: ["all"]` for all shell commands to avoid sandbox failures and duplicate calls.

**Use `working_directory` parameter:**

```typescript
// GOOD
Shell({ command: "pnpm test", working_directory: "apps/api" });

// BAD
Shell({ command: "cd /full/path && pnpm test" });
```
